[
  {
    "name": "groups",
    "type": "base",
    "listRule": "@request.auth.id != ''",
    "viewRule": "@request.auth.id != ''",
    "createRule": "@request.auth.id != ''",
    "updateRule": "@request.auth.id != ''",
    "deleteRule": "@request.auth.id != ''",
    "schema": [
      {
        "name": "name",
        "type": "text",
        "required": true,
        "options": { "min": 2, "max": 80, "pattern": "" }
      },
      {
        "name": "slug",
        "type": "text",
        "required": true,
        "options": { "min": 2, "max": 80, "pattern": "" }
      },
      {
        "name": "owner_user_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "users",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      { "name": "is_active", "type": "bool", "required": true, "options": {} },
      {
        "name": "season",
        "type": "text",
        "required": true,
        "options": { "min": null, "max": 12, "pattern": "" }
      },
      {
        "name": "league_id",
        "type": "number",
        "required": true,
        "options": { "min": 1, "max": null, "noDecimal": true }
      }
    ],
    "indexes": [
      "CREATE UNIQUE INDEX idx_groups_slug ON groups (slug)"
    ],
    "options": {}
  },
  {
    "name": "group_members",
    "type": "base",
    "listRule": "@request.auth.id != ''",
    "viewRule": "@request.auth.id != ''",
    "createRule": "@request.auth.id != '' && user_id = @request.auth.id",
    "updateRule": "@request.auth.id != ''",
    "deleteRule": "@request.auth.id != ''",
    "schema": [
      {
        "name": "group_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "groups",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "user_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "users",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "role",
        "type": "select",
        "required": true,
        "options": { "maxSelect": 1, "values": ["owner", "admin", "member"] }
      },
      {
        "name": "status",
        "type": "select",
        "required": true,
        "options": { "maxSelect": 1, "values": ["active", "invited", "removed"] }
      },
      {
        "name": "joined_at",
        "type": "date",
        "required": true,
        "options": { "min": "", "max": "" }
      }
    ],
    "indexes": [
      "CREATE UNIQUE INDEX idx_group_members_unique ON group_members (group_id, user_id)"
    ],
    "options": {}
  },
  {
    "name": "group_invites",
    "type": "base",
    "listRule": "@request.auth.id != ''",
    "viewRule": "@request.auth.id != ''",
    "createRule": "@request.auth.id != ''",
    "updateRule": "@request.auth.id != ''",
    "deleteRule": "@request.auth.id != ''",
    "schema": [
      {
        "name": "group_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "groups",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "code",
        "type": "text",
        "required": true,
        "options": { "min": 6, "max": 16, "pattern": "" }
      },
      {
        "name": "token",
        "type": "text",
        "required": true,
        "options": { "min": 16, "max": 128, "pattern": "" }
      },
      {
        "name": "created_by",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "users",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "expires_at",
        "type": "date",
        "required": true,
        "options": { "min": "", "max": "" }
      },
      {
        "name": "max_uses",
        "type": "number",
        "required": true,
        "options": { "min": 1, "max": null, "noDecimal": true }
      },
      {
        "name": "uses",
        "type": "number",
        "required": true,
        "options": { "min": 0, "max": null, "noDecimal": true }
      }
    ],
    "indexes": [
      "CREATE UNIQUE INDEX idx_group_invites_code ON group_invites (code)",
      "CREATE UNIQUE INDEX idx_group_invites_token ON group_invites (token)"
    ],
    "options": {}
  },
  {
    "name": "predictions",
    "type": "base",
    "listRule": "@request.auth.id != '' && (user_id = @request.auth.id || (@collection.group_members.user_id ?= @request.auth.id && @collection.group_members.group_id ?= group_id && @collection.group_members.status ?= 'active'))",
    "viewRule": "@request.auth.id != '' && (user_id = @request.auth.id || (@collection.group_members.user_id ?= @request.auth.id && @collection.group_members.group_id ?= group_id && @collection.group_members.status ?= 'active'))",
    "createRule": "@request.auth.id != '' && user_id = @request.auth.id",
    "updateRule": "@request.auth.id != '' && user_id = @request.auth.id",
    "deleteRule": "@request.auth.id != '' && user_id = @request.auth.id",
    "schema": [
      {
        "name": "group_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "groups",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "user_id",
        "type": "relation",
        "required": true,
        "options": {
          "collectionName": "users",
          "cascadeDelete": false,
          "minSelect": null,
          "maxSelect": 1,
          "displayFields": []
        }
      },
      {
        "name": "fixture_id",
        "type": "text",
        "required": true,
        "options": { "min": 1, "max": 64, "pattern": "" }
      },
      {
        "name": "period",
        "type": "text",
        "required": true,
        "options": { "min": null, "max": 24, "pattern": "" }
      },
      {
        "name": "home_pred",
        "type": "number",
        "required": false,
        "options": { "min": 0, "max": 99, "noDecimal": true }
      },
      {
        "name": "away_pred",
        "type": "number",
        "required": false,
        "options": { "min": 0, "max": 99, "noDecimal": true }
      },
      {
        "name": "submitted_at",
        "type": "date",
        "required": true,
        "options": { "min": "", "max": "" }
      },
      {
        "name": "updated_at",
        "type": "date",
        "required": true,
        "options": { "min": "", "max": "" }
      }
    ],
    "indexes": [
      "CREATE UNIQUE INDEX idx_predictions_unique ON predictions (group_id, user_id, fixture_id)"
    ],
    "options": {}
  }
]
